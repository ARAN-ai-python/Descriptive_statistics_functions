# correlation
## 概要
ピアソン積率相関係数やスピアマン順位相関係数は比率尺度・順位尺度同士の相関を見る手法であり、直感的に理解しやすい手法だと思います。  
しかし、名義尺度同士の相関係数や名義尺度と感覚尺度の相関係数の算出方法は比較的厄介で、かつアンケート分析では出番が多いのではないかと思いました。  
調べたところPythonではライブラリとして実装されていないようなので、将来的に使う時のために実装してみました。


## リファレンス
### クラメールの連関係数(Cramer's coefficient of association)
$$
r = \sqrt{\frac{\chi^2}{n(k-1)}}
$$
- 名義尺度同士の相関関係を表す相関係数を算出する手法
- 対象の2つの名義尺度データでクロス集計表を作り、カイ二乗統計量を算出した後、それを理論上最大のカイ二乗統計量で割ることで相関係数を求めている。
  - カイ二乗統計量自体が2つの変数間の関係性の強さを表す指標であり、その大きさを用いているのだから相関関係であると理解できる。
- 値の性質上相関があったとしても相関係数が小さく見積もられてしまうので、ピアソン積率相関係数よりも低い値(0.1等)から相関があると認められる。

#### 使い方
<img width="131" alt="スクリーンショット 2022-06-25 0 57 55" src="https://user-images.githubusercontent.com/67265109/175573843-064b7ab2-8af5-4728-9ae4-ccd7c98156a0.png">
<img width="567" alt="スクリーンショット 2022-06-25 0 58 04" src="https://user-images.githubusercontent.com/67265109/175573856-81f1b7f8-3569-41d5-a845-f2361e4a0e71.png">

1. 上記入力データのように、アンケートの収集結果のようなデータフレームを作成する。
2. そのデータフレームの内、第一引数と第二引数に該当の名義尺度のデータのカラム名、第三引数にデータフレーム自体を入れて関数を実行する。
3. 期待度数とクラメールの連関係数等の出力結果が出てくる。(相関関係の強さの欄はクラメールの連関係数の値によって星三つまで存在し、0:〜0.1, 1:0.1〜0.25, 2:0.25〜0.5, 3:0.5〜という判定である。)


### 相関比(Correlation ratio)
$$
\eta^2 = \frac{S_B}{S_W + S_B}
$$
- 名義尺度と間隔尺度間の相関関係を表す相関係数を算出する手法
- 仕組みとしては分散分析と同様に級内変動と級間変動を求め、全体の変動に対する急患変動の割合を相関比としている
  - 級内変数の割合が高ければ級間のバラつきがデータのバラつきと比較して大きいという意味を表し、相関関係が認められると考えられる
- 値の性質上相関があったとしても相関係数が小さく見積もられてしまうので、ピアソン積率相関係数よりも低い値(0.1等)から相関があると認められる。

#### 使い方
<img width="147" alt="スクリーンショット 2022-06-25 1 06 42" src="https://user-images.githubusercontent.com/67265109/175575088-fa45ee28-b893-4ec0-8c29-a76c1e7f436d.png">
<img width="236" alt="スクリーンショット 2022-06-25 1 06 52" src="https://user-images.githubusercontent.com/67265109/175575096-09f40159-1d65-47a9-90a3-9debdd333cef.png">

1. 上記入力データのように、水準を識別するカラムと違いを測りたい間隔尺度のカラムの2つを持ったデータフレームを用意する。
2. そのデータフレームの内、第一引数と第二引数に該当の名義尺度・間隔尺度のデータのカラム名、第三引数にデータフレーム自体を入れて関数を実行する。
3. 級内変動・級間変動・相関比の出力結果が出てくる。


### 重相関係数(multiple correlation)
$$
\rho_1(2,...p) = \sqrt{\frac{\sigma_1^\mathsf{T} \sum_{22}^{-1} \sigma_1}{\sigma_{11}}}
$$
- 一つの説明変数(従属変数)と複数の目的変数(独立変数)間の相関関係を表す指標である。
- やっていることは目的変数と説明変数で構築された線形式の相関係数の二乗を最大化するということである。
  - 一般的な線形回帰を実行するソフトウェアでは同時に求められる。
- 重相関係数の二乗を**決定係数**といい、線形回帰モデルの目的変数に対する当てはまりの指標として用いられる。

#### 使い方
<img width="158" alt="スクリーンショット 2022-06-26 0 18 40" src="https://user-images.githubusercontent.com/67265109/175779937-4ebdf054-429a-4c9c-84be-e37b12a58d9d.png">
<img width="186" alt="スクリーンショット 2022-06-26 0 18 45" src="https://user-images.githubusercontent.com/67265109/175779942-172bc294-992d-4047-a16d-f3148ed67c6c.png">
1. 上記入力データのように、目的変数と説明変数が含まれるデータフレームを用意する。  

2. そのデータフレームの内、第一引数に目的変数のカラム名、第二引数に説明変数のカラム名のリスト、第三引数に該当のデータフレーム、第四引数に不偏分散かどうかの設定を入力し、関数を実行する。  

  3. 第四引数のddofは1=不偏分散、0=母分散を表す。初期値は1であり、データを標本であるとして扱うようになっている。  

4. 重相関係数と決定係数が出力される。  


### 正準相関係数(canonical correlation)
$$
\rho = \frac{E[u(x)v(y)]}{\sqrt{E[u(x)^2]} \sqrt{v(y)^2}} = \frac{a^T V_{xy} b}{\sqrt{a^T V_{xx} a} \sqrt{b^T V_{yy} b}}
$$

$$
u(x) = a^T x, v(y) = b^T y
$$
- 複数の量的変数と複数の量的変数間の相関関係を表す指標である。
- 複数の変数を2つの合成変数にまとめ、その合成変数間の相関係数を最大にするということをやっている。

#### 使い方
<img width="262" alt="スクリーンショット 2022-12-12 19 50 33" src="https://user-images.githubusercontent.com/67265109/207027035-f8bcd9f4-3ac8-49e5-ac59-39b0cc4e0704.png">
1. 上記入力データのように、相関関係が知りたい各群における特徴量が含まれるデータフレームを用意する。  

2. 関数CCAに群Aの特徴量x1、群Bの特徴量x2、データの標準化有無scaleを入力する。  

3. 正準相関係数が出力される。  

## 参考文献
- 正準相関分析入門、赤穂昭太郎、日本神経回路学会誌(https://www.jstage.jst.go.jp/article/jnns/20/2/20_62/_pdf)
