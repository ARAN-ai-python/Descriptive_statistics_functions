# cross_tabulation
## 概要
インターンにてアンケートをクロス集計によって分析し、示唆を得る分析を経験しました。
クロス集計自体はそんなに難しいことではなく、条件を絞って集計することで様々な示唆が簡単に得られる事実に感動しました。  
ただ、中には差があるのかどうか微妙であったり、クロス集計を多重にし過ぎた為にサンプルサイズが小さくなって誤差と判別がつきにくくなってしまったものもありました。

その中で、それぞれの要素による差に数学的裏付けを付けるものとして統計的検定に目をつけました。googleスプレッドシートにてカイ二乗検定を実行しようとしたところ、
どうやらカイ二乗検定には注意点があるらしく、独立性の検定に興味が湧きました。そして例によって自動化したくなり、カイ二乗検定及びフィッシャーの正確確率検定をPythonで実装しました。

## リファレンス
### chi2_test
- クロス集計の適合度＆独立性の検定である。
- 主に名義尺度の変数に用いる。
- ある程度全体のサンプルサイズが大きい場合に用いられる。
- 適合度の検定において有意差が認められた場合は「実測値の分布は理論値の分布と一致しない」事が言える。
  - 帰無仮説：実測値の分布と理論値の分布は一致している
  - 対立仮説：実測値の分布と理論値の分布は一致していない
- 独立性の検定において有意差が認められた場合は「２要素に関係がある」事が言える。
  - 帰無仮説：要素１と要素２は独立である（関連がない）
  - 対立仮説：要素１と要素２は独立でない（関連がある）
- **独立性の検定における注意** ：期待度数の内、全体のセルの **20%以上** が5未満であった場合、この検定を用いるべきではない。その場合はフィッシャーの正確確率検定を採用する。(これをコクラン・ルールという。)  
(例えば、2✖️2のクロス集計表における期待度数にて一つでも5以下の値があった場合、4つの期待度数の内の1つであるので全体の25%に相当することが分かる。)

#### 使い方
##### 適合度の検定
<img width="345" alt="スクリーンショット 2022-03-03 11 52 11" src="https://user-images.githubusercontent.com/67265109/156487198-259e0ad5-d4d3-4830-ae5e-654989e232ea.png">
<img width="377" alt="スクリーンショット 2022-03-03 11 52 21" src="https://user-images.githubusercontent.com/67265109/156487209-6c8fe6cb-0c0b-41b1-bbfb-1a513e6cdb22.png">

1. 上記画像のデータフレームの様にクロス集計表を用意する。(testが検定対象のクロス集計表、theoryが分布理論値表)
2. この2つのデータフレームを引数としてchi2_test関数を実行する。
3. 上記画像の括弧内の2つの値の内、右が検定統計量χ^2、左がp値として出力される。

##### 独立性の検定
<img width="699" alt="スクリーンショット 2022-02-25 18 49 31" src="https://user-images.githubusercontent.com/67265109/155693806-ec6daa6a-d88a-470b-91b2-0a28471a99a8.png">
<img width="701" alt="スクリーンショット 2022-02-25 18 49 39" src="https://user-images.githubusercontent.com/67265109/155693955-bb531a65-d49d-4b2d-adc9-0104df160d8e.png">
<img width="734" alt="スクリーンショット 2022-02-25 18 49 49" src="https://user-images.githubusercontent.com/67265109/155693962-2a46e53b-e735-4307-9b73-ba062550a618.png">

1. 上記画像のデータフレームの様にクロス集計表を用意する。
2. このデータフレームを引数としてchi2_test関数を実行する。
3. 上記画像の括弧内の4つの値の内、順に検定統計量χ^2(イェーツの補正無し)、p値(イェーツの補正無し)、検定統計量χ^2(イェーツの補正有り)、p値(イェーツの補正有り)として出力される。
4. 最後の画像の出力結果のように、期待度数の内全体のセルの **20%以上** が5未満であった場合、警告を出してくれる。この警告が出力された場合、以下のフィッシャーの正確確率検定の採用を検討する。


### fisher_exact_test
- クロス集計の独立性の検定である。
- 主に名義尺度の変数に用いる。
- 全体のサンプルサイズが小さい場合に用いられる。
- 有意差が認められた場合は「２要素に関係がある」事が言える。
  - 帰無仮説：要素１と要素２は独立である（関連がない）
  - 対立仮説：要素１と要素２は独立でない（関連がある）
- この検定はカイ二乗検定のような制約は特になく、どのような時にでも採用できる。
- この検定はp値を直接求めるため、検定統計量は存在しない。

#### 使い方
<img width="171" alt="スクリーンショット 2022-02-25 18 49 59" src="https://user-images.githubusercontent.com/67265109/155693933-88240194-7ac7-4a9d-ae4e-7bbb2b1cb537.png">

1. 上記画像のデータフレームの様にクロス集計表を用意する。
2. このデータフレームを引数としてfisher_exact_test関数を実行する。
3. 上記画像の通り、p値が返り値として出力される。
