# cross_tabulation
## 概要
インターンにてアンケートをクロス集計によって分析し、示唆を得る分析を経験しました。
クロス集計自体はそんなに難しいことではなく、条件を絞って集計することで様々な示唆が簡単に得られる事実に感動しました。  
ただ、中には差があるのかどうか微妙であったり、クロス集計を多重にし過ぎた為にサンプルサイズが小さくなって誤差と判別がつきにくくなってしまったものもありました。

その中で、それぞれの要素による差に数学的裏付けを付けるものとして統計的検定に目をつけました。googleスプレッドシートにてカイ二乗検定を実行しようとしたところ、
どうやらカイ二乗検定には注意点があるらしく、独立性の検定に興味が湧きました。そして例によって自動化したくなり、カイ二乗検定及びフィッシャーの正確確率検定をPythonで実装しました。

## リファレンス
### chi2_test
- クロス集計の独立性の検定である。
- 主に名義尺度の変数に用いる。
- ある程度全体のサンプルサイズが大きい場合に用いられる。
- 有意差が認められた場合は「２要素に関係がある」事が言える。
  - 帰無仮説：要素１と要素２は独立である（関連がない）
  - 対立仮説：要素１と要素２は独立でない（関連がある）
- **注意** ：期待度数の内、全体のセルの **20%以上** が5未満であった場合、この検定を用いるべきではない。その場合はフィッシャーの正確確率検定を採用する。(これをコクラン・ルールという。)  
(例えば、2✖️2のクロス集計表における期待度数にて一つでも5以下の値があった場合、4つの期待度数の内の1つであるので全体の25%に相当することが分かる。)

#### 使い方
<img width="359" alt="スクリーンショット 2022-02-16 23 02 34" src="https://user-images.githubusercontent.com/67265109/154283150-310ec7b8-c1b6-4b08-8108-c68060369bd6.png">
<img width="498" alt="スクリーンショット 2022-02-16 23 02 46" src="https://user-images.githubusercontent.com/67265109/154283834-430fa137-3465-4f5f-b01a-ea12ee92d496.png">

1. 上記画像のデータフレームの様にクロス集計表を用意する。
2. このデータフレームを引数としてchi2_test関数を実行する。(実行する際、キーワード引数であるyatesをTrueに設定するとイェーツの補正を用いた検定がなされる。)
3. 上記画像の括弧内の2つの値の内、左が検定統計量、右がp値と二つの返り値として出力される。


### fisher_exact_test
- クロス集計の独立性の検定である。
- 主に名義尺度の変数に用いる。
- 全体のサンプルサイズが小さい場合に用いられる。
- 有意差が認められた場合は「２要素に関係がある」事が言える。
  - 帰無仮説：要素１と要素２は独立である（関連がない）
  - 対立仮説：要素１と要素２は独立でない（関連がある）
- この検定はカイ二乗検定のような制約は特になく、どのような時にでも採用できる。
- この検定はp値を直接求めるため、検定統計量は存在しない。

#### 使い方
<img width="167" alt="スクリーンショット 2022-02-16 23 02 57" src="https://user-images.githubusercontent.com/67265109/154284882-3d813854-853b-4374-861f-f8f4244a27bd.png">

1. 上記画像のデータフレームの様にクロス集計表を用意する。
2. このデータフレームを引数としてfisher_exact_test関数を実行する。
3. 上記画像の通り、p値が返り値として出力される。
